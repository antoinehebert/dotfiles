default_username="^(ahebert|t00ny)$"

# shell color
fblack=$(tput setaf 0)
fred=$(tput setaf 1)
fgreen=$(tput setaf 2)
fyellow=$(tput setaf 3)
fblue=$(tput setaf 4)
fmagenta=$(tput setaf 5)
fcyan=$(tput setaf 6)
fwhite=$(tput setaf 7)
fdefault=$(tput setaf 9)
bblack=$(tput setab 0)
bred=$(tput setab 1)
bgreen=$(tput setab 2)
byellow=$(tput setab 3)
bblue=$(tput setab 4)
bmagenta=$(tput setab 5)
bcyan=$(tput setab 6)
bwhite=$(tput setab 7)
bdefault=$(tput setab 9)
reset=$(tput sgr0)

# GIT
# Fastest possible way to check if repo is dirty. a savior for the WebKit repo.
function parse_git_dirty() {
   if [[ -n $(git diff --quiet --ignore-submodules HEAD &>/dev/null; [ $? -eq 1 ] && echo "1") ]]; then
      echo -e "✗"
   else
      echo -e "✓"
   fi
}

function git_prompt() {
   if [[ -n $(git branch 2> /dev/null) ]]; then 
      echo -n $(git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/\1/")
      echo -n " $(parse_git_dirty) "
   fi
}

# SVN
function svn_prompt() {
   # change color based on status? Slow on big repos so might be cool to turn off
   # sometimes...
   if $(svn info > /dev/null 2>&1); then
      # branch name
      echo -n "$(svn info | grep '^URL:' | egrep -o 'trunk|(branches|tags)/.*') "

      # dirty?
      if $(svn status|grep -E '^\s*[ACDIM!L]' >/dev/null 2>&1); then
         echo -e "✗ "
      else
         echo -e "✓ "
      fi

      echo
   fi
}


# Only show username/host if not default
function usernamehost() {
	if ! [[ $USER =~ $default_username ]]; then echo "$USER "; fi
}

PS1="\[$fred\]\$(usernamehost)\[$reset\]\[$fblue\]\$(git_prompt)\$(svn_prompt)\[$reset\]\W \[$fcyan\]→\[$reset\] "
